#!/usr/bin/env node
(function () {var a,b,e={};Object.defineProperty(e,"__esModule",{value:!0});var f=".packages";e.linkedPackagesName=f;var ga,fa,t="firebase";e.DEFAULT_RUNNER=t,function(e){e.PACKAGE_JSON="package.json",e.PACKAGE_TEMP_JSON="package.temp.json"}(ga=a||(a={},e.WorkingFiles=a)),function(e){e.REVERT="--revert-changes",e.BUILD="--buildCommand",e.LEAVE_CHANGES="--leave-changes"}(fa=b||(b={},e.Tasks=b));var r={};Object.defineProperty(r,"__esModule",{value:!0});var l=e=>process.argv.toString().includes(e);r.includes=l;var z=(e,r=!0,t=e=>e)=>{if(process.argv.toString().includes(b[e])){const $=process.argv[process.argv.indexOf(e)+1];return $?$.includes("--")?r:t($):r}return r};r.nextOrDefault=z;var A={};Object.defineProperty(A,"__esModule",{value:!0});const da=require("child_process");var m=({command:r,args:e,cwd:s}={command:"npx",args:[]},o=!0)=>new Promise(($,p)=>{const c=da.spawn(r,e,{cwd:s});o&&c.stderr.pipe(process.stderr),o&&c.stdout.pipe(process.stdout),c.on("close",r=>0!==r?p(!!r):$(!!r))});A.Worker=m;var g={},u=g&&g.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(s,c){function t(r){try{i(a.next(r))}catch(e){c(e)}}function u(r){try{i(a.throw(r))}catch(e){c(e)}}function i(r){var e;r.done?s(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,u)}i((a=a.apply(r,e||[])).next())})};Object.defineProperty(g,"__esModule",{value:!0});const I=require("fs"),v=require("path"),O=require("util");function _(){return u(this,void 0,void 0,function*(){return yield Promise.all((yield O.promisify(I.readdir)(v.join(process.cwd(),f))).map(r=>u(this,void 0,void 0,function*(){yield m({command:"npx",args:z(b.BUILD,"tsc").split(" "),cwd:v.join(process.cwd(),f,r)},!1)})))})}var w=_;g.buildPackages=w;var h={},E=h&&h.__awaiter||function(e,r,o,$){return new(o||(o=Promise))(function(a,n){function t(e){try{Q($.next(e))}catch(r){n(r)}}function c(e){try{Q($.throw(e))}catch(r){n(r)}}function Q(e){var r;e.done?a(e.value):(r=e.value,r instanceof o?r:new o(function(e){e(r)})).then(t,c)}Q(($=$.apply(e,r||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});function J(e){return E(this,void 0,void 0,function*(){yield Promise.all(e.map(({folder:e})=>E(this,void 0,void 0,function*(){const r=["-r","--exclude","node_modules","--exclude","dist","--exclude",".cache",e,`./${f}`];yield m({command:"rsync",args:r})})))})}var B=J;h.copyPackages=B;var D={};Object.defineProperty(D,"__esModule",{value:!0});const P=require("fs"),V=require("path");function W(e,$){P.writeFileSync(V.join(process.cwd(),e),JSON.stringify($,null,2),{encoding:"utf-8"})}var p=W;D.writeFileJson=p;var k={},ea=k&&k.__awaiter||function(n,e,r,a){return new(r||(r=Promise))(function($,t){function i(n){try{o(a.next(n))}catch(e){t(e)}}function l(n){try{o(a.throw(n))}catch(e){t(e)}}function o(n){var e;n.done?$(n.value):(e=n.value,e instanceof r?e:new r(function(n){n(e)})).then(i,l)}o((a=a.apply(n,e||[])).next())})};Object.defineProperty(k,"__esModule",{value:!0});const F=require("fs"),G=require("util");function H(n){return ea(this,void 0,void 0,function*(){l(b.LEAVE_CHANGES)?(yield G.promisify(F.exists)(a.PACKAGE_TEMP_JSON))||p(a.PACKAGE_TEMP_JSON,n):p(a.PACKAGE_JSON,n),process.exit()})}var c=H;k.exitHandler=c;var n={},x=n&&n.__awaiter||function(e,i,$,n){return new($||($=Promise))(function(t,o){function r(e){try{p(n.next(e))}catch(i){o(i)}}function a(e){try{p(n.throw(e))}catch(i){o(i)}}function p(e){var i;e.done?t(e.value):(i=e.value,i instanceof $?i:new $(function(e){e(i)})).then(r,a)}p((n=n.apply(e,i||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const L=require("fs"),M=require("util");function N(e,i){return x(this,void 0,void 0,function*(){yield Promise.all(i.map(({dep:i})=>x(this,void 0,void 0,function*(){e.dependencies[i]=`file:./${f}/${i.split("/")[1]}`}))),yield M.promisify(L.writeFile)(a.PACKAGE_JSON,JSON.stringify(e,null,2),{encoding:"utf-8"})})}var y=N;n.modifyJson=y;var o={},Q=o&&o.__awaiter||function(r,e,$,t){return new($||($=Promise))(function(n,a){function o(r){try{J(t.next(r))}catch(e){a(e)}}function i(r){try{J(t.throw(r))}catch(e){a(e)}}function J(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(o,i)}J((t=t.apply(r,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const R=require("fs"),S=require("path"),T=require("util");function U(r){return Q(this,void 0,void 0,function*(){return JSON.parse((yield T.promisify(R.readFile)(S.join(process.cwd(),r),{encoding:"utf-8"})))})}var q=U;o.readJson=q;var j={},X=j&&j.__awaiter||function(n,e,r,$){return new(r||(r=Promise))(function(t,i){function o(n){try{w($.next(n))}catch(e){i(e)}}function a(n){try{w($.throw(n))}catch(e){i(e)}}function w(n){var e;n.done?t(n.value):(e=n.value,e instanceof r?e:new r(function(n){n(e)})).then(o,a)}w(($=$.apply(n,e||[])).next())})};Object.defineProperty(j,"__esModule",{value:!0});const Y=require("fs"),Z=require("util");function $(){return X(this,void 0,void 0,function*(){p(a.PACKAGE_JSON,(yield q(a.PACKAGE_TEMP_JSON))),yield Z.promisify(Y.unlink)(a.PACKAGE_TEMP_JSON)})}var C=$;j.revertJson=C;var i={},ba=i&&i.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(n,i){function t(r){try{o(a.next(r))}catch(e){i(e)}}function s(r){try{o(a.throw(r))}catch(e){i(e)}}function o(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,s)}o((a=a.apply(r,e||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});function ca(){return ba(this,void 0,void 0,function*(){const r=yield q(a.PACKAGE_JSON);r.fireConfig=r.fireConfig||{};const e=r.fireConfig.runner||t,$=JSON.parse(JSON.stringify(r));if(l(b.REVERT))return yield C();if(r&&r.fireDependencies){const e=r.fireDependencies,n=Object.keys(e).map(r=>({dep:r,folder:e[r]}));if(yield B(n),l(b.BUILD))try{yield w()}catch(a){}process.stdin.resume(),process.on("exit",()=>c($)),process.on("SIGINT",()=>c($)),process.on("SIGUSR1",()=>c($)),process.on("SIGUSR2",()=>c($)),process.on("uncaughtException",()=>c($)),yield y(r,n)}yield m({command:"npx",args:[e,...process.argv.slice(2).filter(r=>r!==b.LEAVE_CHANGES&&r!==b.REVERT&&r!==b.BUILD)]}),c($)})}var s=ca;i.createVirtualSymlink=s;var d={},aa=d&&d.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(c,a){function i(t){try{o(n.next(t))}catch(e){a(e)}}function $(t){try{o(n.throw(t))}catch(e){a(e)}}function o(t){var e;t.done?c(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,$)}o((n=n.apply(t,e||[])).next())})};Object.defineProperty(d,"__esModule",{value:!0});function K(){return aa(this,void 0,void 0,function*(){try{yield s()}catch(t){console.log(t)}})}K();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=d}else if(typeof define==="function"&&define.amd){define(function(){return d})}})();